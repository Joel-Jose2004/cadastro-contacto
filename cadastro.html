<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="cadastro.css">
</head>
<body>
    
    <div id="tudo">
        <div id="valor">
Nome<input type="text" id="nome"><br><p></p>
Telefone<input type="number" id="numero" ><br><p></p>
<input type="hidden" id="id_usu" ><br><p></p>
<input type="file" id="ficheiro"><br><p></p>
<button onclick="salvar()">Salvar</button>
<button onclick="troca()">Actualizar</button>
</div>
</div>

<div id="cont">
<div id="contiudo" style="margin-top: 10px;">
</div>
</div>





<script>
    function salvar() {
        var nome_usuario = String(document.getElementById("nome").value);
        var numero_usuario = Number(document.getElementById("numero").value);
        var imagem = document.getElementById("ficheiro").files[0];
    
        // Array para armazenar os dados
        var valor1 =[];
        
        
        // Recuperar dados do localStorage se existir
        if (localStorage.hasOwnProperty("valor1")) {
            
            valor1 = JSON.parse(localStorage.getItem("valor1"));
            
            
        }
    
        // Ler a imagem e convertê-la em Base64
        if (imagem) {
            var reader = new FileReader();
           
            reader.onloadend = function () {
                const id=valor1.length+1
                valor1.push({id,nome: nome_usuario, telefone: numero_usuario, imagem: reader.result });
                localStorage.setItem("valor1", JSON.stringify(valor1));
                exibirDados(valor1);
            };
            reader.readAsDataURL(imagem); // Lê a imagem como URL Base64
            
        } 
        
    }
    
    function limpar(){
        document.getElementById("nome").value="";
        document.getElementById("numero").value="";
        document.getElementById("ficheiro").value="";
    }
    function deletar(id) {
                var valor1 = JSON.parse(localStorage.getItem("valor1")) || [];
                valor1 = valor1.filter(item => item.id !== id); // Filtrar o item a ser removido
                localStorage.setItem("valor1", JSON.stringify(valor1)); // Atualiza o localStorage
                exibirDados(valor1); // Atualiza a exibição
            }
    // Função para exibir os dados
    function exibirDados(valor1) {
        var contiudo = document.getElementById("contiudo");
        contiudo.innerHTML = ''; // Limpar conteúdo anterior
        valor1.forEach(function(item) {
            contiudo.insertAdjacentHTML('beforeend',"<div class='item'>"+ 
             (item.imagem ? "<img src='" + item.imagem + "' style='max-width: 50px;'>" : "") +"<div class='item'>"+
               item.nome +"</div>"+"<div class='item'>" +item.telefone+"</div>"+ 
               "<button class='item' onclick='deletar(" + item.id + ")'>Deletar</button>" +
               "<button class='item' onclick='mudar("+JSON.stringify(item)+")'>Mudar</button>"+ 
             "</div>"+"<hr>"
           
            );
            
        });
        limpar();
        
    }
    
    function mudar(item){
    document.getElementById("nome").value=item.nome;
    document.getElementById("numero").value=item.telefone;
    document.getElementById("id_usu").value=item.id;
    
    }
    
    function troca() {
                var nome_actual = String(document.getElementById("nome").value);
                var numero_actual = Number(document.getElementById("numero").value);
                var nova_imagem=document.getElementById("ficheiro").files[0];
                var id = Number(document.getElementById("id_usu").value);
                if(!nome_actual || !numero_actual || !nova_imagem){
                    alert("Um dos campos está vazio");
                    return;
                }
    
    
                        var valor1 = JSON.parse(localStorage.getItem("valor1")) || [];
                valor1 = valor1.map(item => item.id === id ? { ...item,imagem:ler.result ,nome: nome_actual, telefone: numero_actual } : item);
                localStorage.setItem("valor1", JSON.stringify(valor1));
                            exibirDados(valor1);

    
                     
            }
    
    window.onload = function() {
        if (localStorage.hasOwnProperty("valor1")) {
            var valor1 = JSON.parse(localStorage.getItem("valor1"));
            exibirDados(valor1);
        
          
        }
    };
    
</script>    










</body>
</html>